name: Clean Releases
on:  
  schedule:
    - cron: '00 1 * * *'  # At 01:00 on Mondays.

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  clean:
    name: Clean Old Releases
    runs-on: ubuntu-24.04
    steps:
      - name: "Remove all but the last 10 releases"
        run: |
          for release in $(gh api -X GET repos/bozemanpass/stack/releases --paginate | jq -r '.[] | .tag_name' | tail -n +10);
            do gh release delete --cleanup-tag -y "$release"
          done
